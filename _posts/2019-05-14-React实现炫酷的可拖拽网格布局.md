---
layout:     post
title:      Reactå®ç°ç‚«é…·çš„å¯æ‹–æ‹½ç½‘æ ¼å¸ƒå±€
subtitle:   å¯æ‹–æ‹½è‡ªå®šä¹‰é¢æ¿
date:       2019-05-08
author:     Bilif
header-img: img/post-bg-ios10.jpg
catalog: true
tags:
    - React
    - ç»„ä»¶æ‹–æ‹½
---

# å‰è¨€
æœ€è¿‘è€æ¿è®©åšä¸€ä¸ªè‡ªå®šä¹‰é¢æ¿ï¼Œèƒ½å¤Ÿåœ¨é¢æ¿ä¸Šè‡ªç”±çš„æ‹–æ‹½ï¼Œæ–°å¢ï¼Œåˆ é™¤ç»„ä»¶ã€‚ç»„ä»¶å¯ä»¥æ˜¯å„ç§echartså›¾å½¢ï¼Œé€šè¿‡å„ä¸ªç»„ä»¶çš„æ‹–æ‹½ç»„åˆï¼Œä»è€Œè®©ç”¨æˆ·è‡ªå®šä¹‰æƒ³è¦çœ‹åˆ°çš„é¢æ¿ã€‚éœ€æ±‚å°±æ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆæ’¸èµ·è¢–å­å¼€å§‹å¹²ï¼ğŸ˜‚

# é¡¹ç›®é¢„è§ˆ
[demoåœ°å€](https://bilif.github.io/react-drag-grid/)

![QQ20190514-131658-HD-compress.gif](https://user-gold-cdn.xitu.io/2019/5/14/16ab4e3123933a26?w=599&h=321&f=gif&s=310674)

ç»„ä»¶å¯ä»¥åŠ¨æ€æ·»åŠ ï¼Œåˆ é™¤ï¼Œå¯ä»¥è‡ªç”±æ‹–æ‹½ï¼Œç¼©æ”¾ã€‚å¹¶ä¸”ç¼©æ”¾åç»„ä»¶å†…éƒ¨çš„echartså›¾è¡¨ä¹Ÿä¼šè·Ÿç€ç¼©æ”¾ã€‚

# é¡¹ç›®å®æˆ˜

##### æŠ€æœ¯æ¶æ„

1. å‰ç«¯æ¡†æ¶ï¼š[React](https://react.docschina.org/)
2. UIåº“ï¼š[Ant Design](https://ant.design/index-cn)
3. è„šæ‰‹æ¶ï¼š[create-react-app](https://github.com/facebook/create-react-app)
4. æ‹–æ‹½æ’ä»¶ï¼š[react-grid-layout](https://github.com/STRML/react-grid-layout)

##### æŠ€æœ¯å®ç°
1.ä½¿ç”¨npmå®‰è£…react-grid-layoutåŒ…
```
npm install react-grid-layout
```

2.åœ¨jsæ–‡ä»¶ä¸­å¼•å…¥WidthProviderå’ŒResponsiveç»„ä»¶ï¼Œå¹¶ä¸”å®ä¾‹åŒ–å“åº”å¼æ‹–æ‹½ç»„ä»¶ã€‚åœ¨cssæ–‡ä»¶ä¸­å¼•å…¥æ’ä»¶çš„æ ·å¼ã€‚
```
import { WidthProvider, Responsive } from "react-grid-layout";
const ResponsiveReactGridLayout = WidthProvider(Responsive);
@import '~react-grid-layout/css/styles.css';
@import '~react-resizable/css/styles.css';
```

3.åœ¨Reactçš„renderæ–¹æ³•ä¸­æ¸²æŸ“å¯æ‹–æ‹½å¸ƒå±€ã€‚ResponsiveReactGridLayoutç»„ä»¶æœ‰å¤šä¸ªå±æ€§ï¼Œè¿™é‡Œä¸¾å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„è¯´æ˜ä¸€ä¸‹ï¼š

    - colsï¼šå®šä¹‰äº†å“åº”å¼å¸ƒå±€åˆ’åˆ†æˆå‡ åˆ—ã€‚
    - rowHeightï¼šå“åº”å¼å¸ƒå±€ä¸­ç»„ä»¶çš„è¡Œé«˜ã€‚
    - onLayoutChangeï¼šå½“å“åº”å¼å¸ƒå±€ä¸­çš„ç»„ä»¶å‘ç”Ÿæ‹–æ‹½æˆ–è€…æ”¾å¤§ç¼©å°æ—¶è§¦å‘è¯¥å‡½æ•°ã€‚

```
<ResponsiveReactGridLayout
    className="layout"
    {...this.props}
    layouts={this.state.layouts}
    onLayoutChange={(layout, layouts) =>
              this.onLayoutChange(layout, layouts)
            }
   >
     {this.generateDOM()}
</ResponsiveReactGridLayout>
```

4.é€šè¿‡generateDOMå‡½æ•°ç”Ÿæˆå¸ƒå±€ä¸­çš„ç»„ä»¶,é¦–å…ˆå…ˆéå†ç»„ä»¶æ•°ç»„ï¼Œé€šè¿‡æ¯ä¸ªç»„ä»¶çš„ç±»å‹åˆ¤æ–­ç”Ÿäº§æŸ±çŠ¶å›¾ç»„ä»¶ï¼ŒæŠ˜çº¿ç»„ä»¶ï¼Œè¿˜æ˜¯é¥¼å›¾ç»„ä»¶ã€‚æ¯ä¸ªç»„ä»¶å¿…é¡»å®šä¹‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„keyå€¼ã€‚data-gridä¸ºæ¯ä¸€ä¸ªç»„ä»¶ç»‘å®šäº†å…¶å±æ€§ã€‚ä¸‹é¢ä¼šä»‹ç»å…·ä½“çš„data-gridå±æ€§ã€‚
```
 generateDOM = () => {
    return _.map(this.state.widgets, (l, i) => {
      let option;
      if (l.type === 'bar') {
        option = getBarChart();
      }else if (l.type === 'line') {
        option = getLineChart();
      }else if (l.type === 'pie') {
        option = getPieChart();
      }
      let component = (
        <ReactEcharts
          option={option}
          notMerge={true}
          lazyUpdate={true}
          style={{width: '100%',height:'100%'}}
        />
      )
      return (
        <div key={l.i} data-grid={l}>
          <span className='remove' onClick={this.onRemoveItem.bind(this, i)}>x</span>
          {component}
        </div>
      );
    });
  };
```

5.é€šè¿‡addItemå‡½æ•°æ¥æ–°å¢ç»„ä»¶ã€‚æ¯ä¸ªç»„ä»¶å±æ€§å¦‚ä¸‹ï¼š

    - x: ç»„ä»¶åœ¨xè½´åæ ‡
    - y: ç»„ä»¶åœ¨yè½´åæ ‡
    - w: ç»„ä»¶å®½åº¦
    - h: ç»„ä»¶é«˜åº¦
    - i:  ç»„ä»¶keyå€¼

```
addItem(type,widgetId) {
    const addItem = {
      x: (this.state.widgets.length * 2) % (this.state.cols || 12),
      y: Infinity, // puts it at the bottom
      w: 2,
      h: 2,
      i: widgetId || new Date().getTime().toString(),
    };
    this.setState(
      {
        widgets: this.state.widgets.concat({
          ...addItem,
          type,
        }),
      },
    );
  };
```

6.é€šè¿‡onRemoveItemå‡½æ•°æ¥ç§»é™¤å¢ç»„ä»¶ã€‚
```
onRemoveItem(i) {
    console.log(this.state.widgets)
    this.setState({
      widgets: this.state.widgets.filter((item,index) => index !=i)
    });

  }
```

# åè®°

**æ„Ÿè°¢æ”¯æŒã€‚è‹¥ä¸è¶³ä¹‹å¤„ï¼Œæ¬¢è¿å¤§å®¶æŒ‡å‡ºï¼Œå…±å‹‰ã€‚**

**å¦‚æœè§‰å¾—ä¸é”™ï¼Œè®°å¾— ç‚¹èµï¼Œè°¢è°¢å¤§å®¶** ğŸ˜‚

[æºç åœ°å€](https://github.com/Bilif/react-drag-grid)

> æ¬¢è¿å…³æ³¨ æˆ‘çš„ï¼š[ã€Blogã€‘](https://bilif.github.io/)[ã€Githubã€‘](https://github.com/Bilif)[ã€æ˜é‡‘ã€‘](https://juejin.im/user/58b5198cac502e00589a6388)[ã€ç®€ä¹¦ã€‘](https://www.jianshu.com/u/94a557704b3e)



